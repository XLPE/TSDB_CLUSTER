

============================== TSDB 数据整合模块=====================================


      ------------------- 1. 从redis导出数据到TSDB -----------------------

   （1）配置config.lua 文件：
	a. EXPIRE_TIME: 当数据成功导入到TSDB，redis中的数据失效时间，单位: second
	b. DEFAULT_START_TIME: 设置默认的数据导出开始时间，主要作用于只设置开始时间，而没有设置结束时间，时间格式：2014-05-23 10:43:47
	c. ALLOW_SETTIME: 是否允许设置导出一个具体时间段的数据，有0，1两个选择。1为允许设置具体的时间段，这个参数与 START_TIME, END_TIME 这两个参数一起使用，这两个参数的时间格式：2014-05-22 15:12:47。
	d. ALLOW_SLEEP: 该参数主要与 DEFAULT_START_TIME 参数一起使用，主要用在与redis同步导出数据时，每隔10分钟去整合一次数据并写入到TSDB


   （2）步骤（1）完成之后， 运行run.lua文件：
	a. 导出的数据有一份同步到文件中，该数据保存在./data/backFile目录下。该数据文件主要有activeUser和url，每个文件保存一个小时的数据，对于应文件名：activeUser__2014052301.bak 和 url__2014052316.bak，分别表示2014-05-23 01:00:00--01:59:59 的activeUser 和2014-05-23 16:00:00--16:59:59 的url数据。
	b. 如果导出数据环节出现错误，则会将错误原因及对应那条数据的key记录到./data/errorLog目录下。对于设置redis中的数据失败错误，会记录到expireTime.log文件，对于某个10分钟没有数据，则会记录到emptyUser.log文件，其他错误则记录在error.log文件中




      --------------------- 2.从redis备份数据到本地文件 --------------------
   
   （1）配置config.lua文件：
	参数配置过程和上面redis导出数据到TSDB一样

   （2）运行 write_file.lua 文件：
	a. 备份到文件中的数据保存在./data/recoveryFile目录下，对于应文件名：activeUser__2014052301.rev 和 url__2014052316.rev，其解释同上面
	b. 如果备份数据环节出错，也会被记录在./data/errorLog下面的对应文件中,在文件里面以[REV]和[BAK]前缀来区分是导入TSDB环节出错还是备份到文件环节出错




      --------------------- 3.从备份文件恢复数据到TSDB ------------------------

   （1）该环节主要针对从redis中备份数据到本地之后，需要将备份的数据同步到TSDB。恢复按照每次一个小时进行，同步到TSDB完成后，会将对应的文件拷贝一份到./data/backFile文件中。
   （2）执行该过程无需配置文件，只需执行recovery_to_TSDB.lua 文件：
	a. 该环节出错则会将错误记录保存在./data/errorLog/rev_error.log文件，设置redis中key超时失败也会记录在./data/errorLog/expireTime.log文件中。



